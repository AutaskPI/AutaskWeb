<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Cadastro de Horarios Disponiveis</title>
    <script src="js/jquery.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery.mask.min.js" /></script>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="css/sb-admin.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet">
    <link rel="icon" href="img/logoOficial.png" type="imagem/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js"></script>

</head>

<body class="fixed-nav sticky-footer" id="page-top">
    <style rel="stylesheet" type="text/css">
        .esconder {
            display: none;
            color: red;
        }
    </style>
    <!-- Navigation-->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav" style="box-shadow: 0 -5px 15px 4px black !important;background-color: #494f56">
        <img class="hidden-sm-down" src="img/teste.png" alt="Logo">
        <a id="textoLogo" class="navbar-brand" href="Agendamentos.html">Autask</a>

        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive"
            aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
                <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Components">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseComponents" data-parent="#exampleAccordion">
                        <i class="fa fa-user-circle"></i>
                        <span class="nav-link-text"> Cadastro</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseComponents">
                        <li>
                            <a href="Cadastro_Servicos.html">Cadastro de Serviço</a>
                        </li>
                        <li>
                            <a href="Cadastro_Estabelecimento.html">Cadastro de Estabelecimento</a>
                        </li>
                        <li>
                            <a href="Cadastro_Profissional.html">Cadastro de Profissional</a>
                        </li>
                        <li>
                            <a href="Cadastro_Horarios_Disponiveis.html">Cadastro de Horarios Disponiveis</a>
                        </li>
                        <li>
                            <a href="Cadastro_nao_cliente.html">Cadastro de cliente</a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Example Pages">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseExamplePages" data-parent="#exampleAccordion">
                        <i class="fa fa-briefcase"></i>
                        <span class="nav-link-text"> Financeiro</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseExamplePages">
                        <li>
                           <a href="Dashboard_de_ganho.html">Dashboard de ganho</a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item" data-toggle="tooltip" data-placement="right" title="Menu Levels">
                    <a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseMulti" data-parent="#exampleAccordion">
                        <i class="fa fa-calendar-o"></i>
                        <span class="nav-link-text">Agenda</span>
                    </a>
                    <ul class="sidenav-second-level collapse" id="collapseMulti">
                        <li>
                            <a href="Agendamentos.html">Agendamentos</a>
                        </li>
                    </ul>
                </li>
                </li>
            </ul>
            <ul class="navbar-nav sidenav-toggler" style="background-color:#444">
                <li class="nav-item">
                    <a class="nav-link text-center" id="sidenavToggler">
                        <i class="fa fa-fw fa-angle-left"></i>
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav ml-auto">
                <li id="sair" class="nav-item">
                    <a class="nav-link" data-toggle="modal" data-target="#Sair" href="login.html">
                        <i class="fa fa-fw fa-sign-out "></i>Sair</a>
                </li>
            </ul>
        </div>
    </nav>
    <!-- Começo do conteudo interno-->
    <div class="content-wrapper">
        <h3 style="text-align: center">Cadastro de Horarios</h3>
        <div class="container-fluid">
            <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#Horariosdisponiveis">Cadastro</button>
        </div>
        <div style="padding: 15px">
            <table id="example" class="display">
                <thead>
                    <tr>
                        <th id="eUsuario">Usuario</th>
                        <th id="eData">Data</th>
                        <th id="eHorarioInicial">Horario Inicial</th>
                        <th id="eHorarioFinal">Horario Final</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <!-- /.container-fluid-->
    <!-- /.content-wrapper-->
    <footer class="sticky-footer ">
        <div class="container ">
            <div class="text-center ">
                <small>Copyright © Autask Reviews 2018</small>
            </div>
        </div>
    </footer>
    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded " href="#page-top ">
        <i class="fa fa-angle-up "></i>
    </a>
    <!-- Logout Modal-->
    <div class="modal fade" id="Sair" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title " id="exampleModalLabel ">Confirmar Saida</h5>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body ">Deseja realmente sair?</div>
                    <div class="modal-footer ">
                        <button class="btn btn-secondary " type="button " data-dismiss="modal">Cancelar</button>
                        <a class="btn btn-primary " href="login.html ">Sair</a>
                    </div>
                </div>
            </div>
        </div>
    <!-- Modal Cadastro não cliente-->
    <div class="modal fade" id="Horariosdisponiveis" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cadastro</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>x</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 text-center">
                            <h5 class="display-5">Cadastro de Horarios Disponiveis</h5>
                        </div>
                    </div>
                    <div class="row mb-5">
                        <div class="col-sm-12 text-center">
                            <form class="col s12">
                                <div class="row">
                                    <div class="form-group col-sm-12">
                                        <label for="inputdata">Escolha a Data</label>
                                        <input type="text" class="form-control" name="DataAgenda" id="inputdata" placeholder="Digite a data da agenda">
                                        <p id="msgErrodata" class="msgErro esconder">Preencher o campo Data é obrigatório !</p>
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <label for="inputHorInicio">Escolha o Horario Inicial</label>
                                        <input type="text" class="form-control" name="HorInicio" id="inputHorInicio" placeholder="Digite a Hora de inicio">
                                        <p id="msgErroHorInicio" class="msgErro esconder">Preencher o campo Horario inicial é obrigatório !</p>
                                    </div>
                                    <div class="form-group col-sm-6">
                                        <label for="inputHorFinal">Escolha o Horario Final</label>
                                        <input type="text" class="form-control" name="HorFinal" id="inputHorFinal" placeholder="Digite a Hora de Termino">
                                        <p id="msgErroHorFinal" class="msgErro esconder">Preencher o campo Horario Final é obrigatório !</p>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="cadastrar">Cadastrar</button>
                    <!-- Esta feito para fechar somente-->
                    <button type="submit" class="btn btn-primary" data-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Parte javascript-->
    <script>
        var gridHorario;
        $(document).ready(function () {

            gridHorario = $('#example').DataTable({
                "language": {
                    "sEmptyTable": "Nenhum registro encontrado",
                    "sInfo": "Mostrando de START até END de TOTAL registros",
                    "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
                    "sInfoFiltered": "(Filtrados de MAX registros)",
                    "sInfoPostFix": "",
                    "sInfoThousands": ".",
                    "sLengthMenu": "Mostrando MENU resultados por página",
                    "sLoadingRecords": "Carregando...",
                    "sProcessing": "Processando...",
                    "sZeroRecords": "Nenhum registro encontrado",
                    "sSearch": "Pesquisar",
                    "oPaginate": {
                        "sNext": "Próximo",
                        "sPrevious": "Anterior",
                        "sFirst": "Primeiro",
                        "sLast": "Último"
                    },
                    "oAria": {
                        "sSortAscending": ": Ordenar colunas de forma ascendente",
                        "sSortDescending": ": Ordenar colunas de forma descendente"
                    }
                },
            });

            $('#inputdata').blur(function () {
                if ($(this).val() == null || $(this).val().trim() == "")
                    $('#msgErrodata').fadeIn();
                else
                    $('#msgErrodata').fadeOut(0);
            });

            $('#inputHorInicio').blur(function () {
                if ($(this).val() == null || $(this).val().trim() == "")
                    $('#msgErroHorInicio').fadeIn();
                else
                    $('#msgErroHorInicio').fadeOut(0);
            });

            $('#inputHorFinal').blur(function () {
                if ($(this).val() == null || $(this).val().trim() == "")
                    $('#msgErroHorFinal').fadeIn();
                else
                    $('#msgErrorHorFinal').fadeOut(0);
            });
            
            CarregarHorario();
            $('#inputdata').mask("00/00/0000");
            $('#inputHorInicio').mask("00:00");
            $('#inputHorFinal').mask("00:00");
        });

        $("#cadastrar").click(function () {
            var Datadisponivel = $('#inputdata').val();
            var HorarioInicio = $('#inputHorInicio').val();
            var HorarioFinal = $('#inputHorFinal').val();

            if (Datadisponivel == null || Datadisponivel == "")
                $('#msgErrodata').fadeIn();
            else
                $('#msgErrodata').fadeOut(0);

            if (HorarioInicio == null || HorarioInicio == "")
                $('#msgHorInicio').fadeIn();
            else
                $('#msgHorInicio').fadeOut(0);

            if (HorarioInicio == null || HorarioInicio == "")
                $('#msgErroHorFinal').fadeIn();
            else
                $('#msgErroHorFinal').fadeOut(0);

            split = Datadisponivel.split('/');
			dataame = split[2] + "/" + split[1] + "/" + split[0];
			console.log(dataame);

            if(Validarformulario()){
                var Horario = {
                    CodProfissional : "4",
                    CodUsuario : "21",
                    DataDisponivel:String = dataame,
                    HorarioFinal:String = HorarioFinal,
                    HorarioInicial:String = HorarioInicio,
                }
            }

            $.ajax({
                type:"POST",
                url:"http://saulodacruz2-001-site1.itempurl.com/api/AgendaProfissional/Cadastrar",
                data:Horario,
                success: function (retorno) {
					if (retorno == "Cadastro realizado com sucesso !") {
						$.confirm({
							title: 'Sucesso!',
							content: retorno,
							type: 'green',
							typeAnimated: true,
							buttons: {
								Ok: {
									text: 'Ok',
									btnClass: 'btn-green',
									action: function () {
										CarregarHorario();
										$("#Horariosdisponiveis").modal("hide");
									}
								}
							}
						});
					}
					else {
						$.confirm({
							title: 'Erro!',
							content: retorno,
							type: 'red',
							typeAnimated: true,
							buttons: {
								Ok: {
									text: 'Ok',
									btnClass: 'btn-red',
									action: function () {
									}
								}
							}
						});
					}
				},
				error: function (erro) {
					if (retorno != "Cadastro realizado com sucesso !") {
						$.confirm({
							title: 'Erro!',
							content: "Aconteceu um erro na requisição: " + erro.responseText,
							type: 'red',
							typeAnimated: true,
							buttons: {
								Ok: {
									text: 'Ok',
									btnClass: 'btn-red',
									action: function () {
									}
								}
							}
						});
					}
					else {
						$.confirm({
							title: 'Erro!',
							content: "Por favor, reveja os campos novamente.",
							type: 'red',
							typeAnimated: true,
							buttons: {
								Ok: {
									text: 'Ok',
									btnClass: 'btn-red',
									action: function () {
									}
								}
							}
						});
					}
				}
            })
        }); 

        function CarregarHorario() {
            $.ajax({
                type: "GET",
                url: "http://saulodacruz2-001-site1.itempurl.com/api/AgendaProfissional/ObterTodos",
                success: function (retorno) {
                    gridHorario.draw().clear()
                    var objeto = JSON.parse(retorno);
                    if (objeto.length > 0) {
                        for (i = 0; i < objeto.length; i++) {
                            gridHorario.row.add([
                            objeto[i].CodUsuario,
                            objeto[i].DataDisponivel,
                            objeto[i].HorarioInicial,
                            objeto[i].HorarioFinal
                    ]).draw(false);
        }
                }
        },
        error: function(erro) {
            alert("Aconteceu um erro na requisição: " + erro.respondeText);
        }
    })
        }

        function Validarformulario(){
            if($('#inputdata').val() == null || $('#inputdata').val().trim() == ""||
               $('#inputHorInicio').val() == null || $('#inputHorInicio').val().trim() == ""||
               $('#inputHorFinal').val() == null || $('#inputHorFinal').val().trim() == "")
               return false
            else
                return true
        }
    </script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js "></script>
    <script src="vendor/jquery-easing/jquery.easing.min.js "></script>
    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin.min.js "></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.js"></script>
</body>

</html>